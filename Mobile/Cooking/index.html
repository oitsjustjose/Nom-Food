<!DOCTYPE html>
<html>
	<head>
		<title>Nom: Cook</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
    	<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="icon" type="image/png" href="../img/app-icon.png">
		<link rel="apple-touch-icon" href="../img/app-icon.png">
		
		<link rel="stylesheet" type="text/css" href="../semantic/out/semantic.min.css">
		<link rel="stylesheet" type="text/css" href="../nom.css">
		<script src="../jquery-1.7.2.js"></script>
		<script src="../semantic/out/semantic.min.js"></script>
		<script src="https://www.gstatic.com/firebasejs/4.8.1/firebase.js"></script>
		<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA73dfB5qlWO7f8BdF9_MIdS4pa9QvjtnM"></script>
		<script src="../my-app.js"></script>
	</head>

	<body onLoad="getActiveUser()">		
		<div class="ui sidebar inverted vertical menu">
			<a onClick="location.assign('..')" class="item">Home</a>
			<a onClick="location.assign('../Nearby')" class="item">Nearby Menus</a>
			<a onClick="location.assign('../Cooking')" class="header item">Want to cook for us?</a>
			<a onClick="location.assign('../Account')" class="item" id="user">Log In</a>
		</div>
		
		<!--This is all stuff for the menubar-->
		<div class="ui large inverted teal top fixed menu container">
			<a class="header item" onClick="toggleSidebar()"><i class="sidebar icon"></i>Menu</a>
		</div>
		<div class="pusher" style="padding-top: 48px;">
			<form class="ui form" style="margin-left: 2%; margin-right: 2%;">
				<h2 class="ui dividings header" style="margin-top: 16px;">Restaurant Application Information</h2>
				
				<label>Owner Info</label>
				<div class="two fields">
					<div class="field">
						<input name="first_name" placeholder="First" type="text" id="first_name">
					</div>
					<div class="field">
						<input name="last_name" placeholder="Last" type="text" id="last_name">
					</div>
				</div>
				
				<label>Restaurant Info</label>
				<div class="field">
					<input name="name" placeholder="Restaurant Name" type="text" id="restaurant_name">
				</div>
				<div class="two fields">
					<div class="field">
						<input name="address" placeholder="Street Address" type="text" id="address">
					</div>
					<div class="field">
						<input name="area_code" placeholder="Area Code" type="text" id="area_code">
					</div>
				</div>
				<div class="two fields">
					<div class="field">
						<input name="country" placeholder="Country" type="text" id="country">
					</div>
					<div class="field">
						<select class="ui fluid dropdown" id="food_type">
							<option value="">Food type...</option>
							<option value="ainu">Ainu</option>
							<option value="all-american">All American</option>
							<option value="andhra">Andhra</option>
							<option value="anglo-indian">Anglo Indian</option>
							<option value="arab">Arab</option>
							<option value="armenian">Armenian</option>
							<option value="assyrian">Assyrian</option>
							<option value="awadhi">Awadhi</option>
							<option value="azerbaijani">Azerbaijani</option>
							<option value="balochi">Balochi</option>
							<option value="belarusian">Belarusian</option>
							<option value="bengali">Bengali</option>
							<option value="berber">Berber</option>
							<option value="buddhist">Buddhist</option>
							<option value="bulgarian">Bulgarian</option>
							<option value="cajun">Cajun</option>
							<option value="chechen">Chechen</option>
							<option value="chinese">Chinese</option>
							<option value="chinese-islamic">Chinese Islamic</option>
							<option value="circassian">Circassian</option>
							<option value="creole">Creole</option>
							<option value="crimean-tatar">Crimean Tatar</option>
							<option value="estonian">Estonian</option>
							<option value="filipino">Filipino</option>
							<option value="french">French</option>
							<option value="fusion">Fusion</option>
							<option value="georgian">Georgian</option>
							<option value="goan">Goan</option>
							<option value="goan catholic">Goan Catholic</option>
							<option value="greek">Greek</option>
							<option value="haute">Haute</option>
							<option value="hyderabad">Hyderabad</option>
							<option value="indian-chinese">Indian Chinese</option>
							<option value="indian-singaporean">Indian Singaporean</option>
							<option value="indian">Indian</option>
							<option value="indonesian">Indonesian</option>
							<option value="inuit">Inuit</option>
							<option value="italian american">Italian American</option>
							<option value="italian">Italian</option>
							<option value="japanese">Japanese</option>
							<option value="jewish">Jewish</option>
							<option value="karnataka">Karnataka</option>
							<option value="kazakh">Kazakh</option>
							<option value="kurdish">Kurdish</option>
							<option value="latvian">Latvian</option>
							<option value="latin">Latin</option>
							<option value="lithuanian">Lithuanian</option>
							<option value="maharashtrian">Maharashtrian</option>
							<option value="mangalorean">Mangalorean</option>
							<option value="malay">Malay</option>
							<option value="keralite">Keralite</option>
							<option value="malaysian-indian">Malaysian Indian</option>
							<option value="mexican">Mexican</option>
							<option value="mordovian">Mordovian</option>
							<option value="mughal">Mughal</option>
							<option value="native-american">Native American</option>
							<option value="note-by-note">Note by Note</option>
							<option value="parsi">Parsi</option>
							<option value="Pashtun">Pashtun</option>
							<option value="Polish">Polish</option>
							<option value="pennsylvania-dutch">Pennsylvania Dutch</option>
							<option value="pakistani">Pakistani</option>
							<option value="peranakan">Peranakan</option>
							<option value="persian">Persian</option>
							<option value="portuguese">Portuguese</option>
							<option value="punjabi">Punjabi</option>
							<option value="rajasthani">Rajasthani</option>
							<option value="romanian">Romanian</option>
							<option value="russian">Russian</option>
							<option value="sami">Sami</option>
							<option value="serbian">Serbian</option>
							<option value="sindhi">Sindhi</option>
							<option value="slovak">Slovak</option>
							<option value="slovenian">Slovenian</option>
							<option value="south-indian">South Indian</option>
							<option value="sri-lankan">Sri Lankan</option>
							<option value="tatar">Tatar</option>
							<option value="turkish">Turkish</option>
							<option value="tamil">Tamil</option>
							<option value="udupi">Udupi</option>
							<option value="ukranian">Ukranian</option>
							<option value="vegan">Vegan</option>
							<option value="vegetarian">Vegetarian</option>
							<option value="yamal">Yamal</option>
							<option value="zanzibari">Zanzibari</option>
						</select>
					</div>
				</div>
				<div class="ui button" tabindex="0" id="submit">Submit</div>
			</form>
		</div>
		<script>
			function geocodeAddress(address, owner_email, callback)
			{
				var geocoder= new google.maps.Geocoder();				
				geocoder.geocode( { 'address': address}, function(results, status) {
					if (status == google.maps.GeocoderStatus.OK)
					{
						var lat = results[0].geometry.location.lat();
						var lon = results[0].geometry.location.lng();
						callback(owner_email, lat, lon);
					}
					else
					{
						alert("Geolocation failed; please ensure location services are on and reload the page.")
					}
				});
			}
			
			function uploadToFirebase(owner_email, lat, lon)
			{
				const first_name = document.getElementById("first_name").value;
				const last_name = document.getElementById("last_name").value;
				const restaurant_name = document.getElementById("restaurant_name").value;
				const address = document.getElementById("address").value;
				const area_code = document.getElementById("area_code").value;
				const country = document.getElementById("country").value;
				const food_type = document.getElementById("food_type").value;
				var database = firebase.database();
				const promise = database.ref('Restaurants/' + restaurant_name).set({
					'owner_first': first_name,
					'owner_last': last_name,
					'owner_email': owner_email,
					'address': address,
					'area_code': area_code,
					'country': country,
					'food_type': food_type,
					'lat': lat,
					'lon': lon
				});

				promise
					.then(function() {
						alert("We've added your restaurant, thanks!!");
						window.location = ".";
					})
					.catch(e => alert(e.message));
			}
			
			const submit = document.getElementById("submit");

			submit.addEventListener('click', e => {
				const first_name = document.getElementById("first_name").value;
				const last_name = document.getElementById("last_name").value;
				const restaurant_name = document.getElementById("restaurant_name").value;
				const address = document.getElementById("address").value;
				const area_code = document.getElementById("area_code").value;
				const country = document.getElementById("country").value;
				const food_type = document.getElementById("food_type").value;
				var good = true;

				if (first_name == "")
				{
					document.getElementById("first_name").setAttribute("style", "outline:2px solid red; outline-offset: -2px");
					good = false;
				}
				else
				{
					document.getElementById("first_name").removeAttribute("style", "outline:2px solid red; outline-offset: -2px");
				}
				if (last_name == "")
				{
					document.getElementById("last_name").setAttribute("style", "outline:2px solid red; outline-offset: -2px");
					good = false;
				}
				else
				{
					document.getElementById("last_name").removeAttribute("style", "outline:2px solid red; outline-offset: -2px");
				}
				if (restaurant_name == "")
				{
					document.getElementById("restaurant_name").setAttribute("style", "outline:2px solid red; outline-offset: -2px");
					good = false;
				}
				else
				{
					document.getElementById("restaurant_name").removeAttribute("style", "outline:2px solid red; outline-offset: -2px");
				}
				if (address == "")
				{
					document.getElementById("address").setAttribute("style", "outline:2px solid red; outline-offset: -2px");
					good = false;
				}
				else
				{
					document.getElementById("address").removeAttribute("style", "outline:2px solid red; outline-offset: -2px");
				}
				if (area_code == "")
				{
					document.getElementById("area_code").setAttribute("style", "outline:2px solid red; outline-offset: -2px");
					good = false;
				}
				else
				{
					document.getElementById("area_code").removeAttribute("style", "outline:2px solid red; outline-offset: -2px");
				}
				if (country == "")
				{
					document.getElementById("country").setAttribute("style", "outline:2px solid red; outline-offset: -2px");
					good = false;
				}
				else
				{
					document.getElementById("country").removeAttribute("style", "outline:2px solid red; outline-offset: -2px");
				}
				if(food_type == "")
				{
					document.getElementById("food_type").setAttribute("style", "outline:2px solid red; outline-offset: -2px");
					good = false;
				}
				else
				{
					document.getElementById("food_type").removeAttribute("style", "outline:2px solid red; outline-offset: -2px");
				}

				if (good)
				{
					firebase.auth().onAuthStateChanged(firebaseUser => {
						if (firebaseUser)
						{
							geocodeAddress(address + " " + area_code + " " + country, firebaseUser['email'], uploadToFirebase); 
						}
						else
						{
							alert("Please sign in before submitting...");
						}
					});
				}
			});

		</script>
	</body>
</html>
